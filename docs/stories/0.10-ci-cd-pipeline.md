# Story 0.10: CI/CD Pipeline

## Status
Draft

## Parent Epic
[Epic 0: Technical Foundation](../epic-0-technical-foundation.md)

## Story
**As a** developer,
**I want** automated CI checks on every PR,
**So that** code quality is enforced consistently

## Acceptance Criteria
1. GitHub Actions workflow for CI
2. Lint, typecheck, test jobs
3. Build verification
4. PR previews (optional, for future deployment)
5. Branch protection rules documented

## Tasks / Subtasks
- [ ] Create CI workflow file (AC: 1)
  - [ ] Create `.github/workflows/ci.yml`
  - [ ] Configure trigger on push to main and PRs
  - [ ] Add concurrency settings to cancel in-progress runs
- [ ] Configure lint job (AC: 2)
  - [ ] Set up Node.js 20 with npm cache
  - [ ] Run `npm ci` for clean install
  - [ ] Run `npm run lint`
- [ ] Configure typecheck job (AC: 2)
  - [ ] Set up Node.js environment
  - [ ] Run `npm run typecheck`
- [ ] Configure test job (AC: 2)
  - [ ] Set up Node.js environment
  - [ ] Run `npm test`
  - [ ] Upload coverage to Codecov
- [ ] Configure build verification (AC: 3)
  - [ ] Add build job that depends on lint, typecheck, test
  - [ ] Run `npm run build`
  - [ ] Verify build artifacts created
- [ ] Document branch protection rules (AC: 5)
  - [ ] Document required status checks
  - [ ] Document merge requirements

## Dev Notes

### CI Workflow
```yaml
# .github/workflows/ci.yml
name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  lint:
    name: Lint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      - run: npm ci
      - run: npm run lint

  typecheck:
    name: Type Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      - run: npm ci
      - run: npm run typecheck

  test:
    name: Test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      - run: npm ci
      - run: npm test
      - name: Upload coverage
        uses: codecov/codecov-action@v3
        if: always()

  build:
    name: Build
    runs-on: ubuntu-latest
    needs: [lint, typecheck, test]
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      - run: npm ci
      - run: npm run build
```

### Branch Protection Rules
- Require status checks before merging
- Required checks: lint, typecheck, test, build
- Require branches to be up to date before merging
- Require pull request reviews (optional for solo dev)

### Testing
- **Test file location**: N/A (CI configuration)
- **Test standards**: Verify workflow syntax is valid
- **Verification**: Create test PR to verify workflow runs

## Definition of Done
- [ ] `.github/workflows/ci.yml` created
- [ ] Lint job runs and enforces ESLint rules
- [ ] Typecheck job verifies TypeScript
- [ ] Test job runs all tests with coverage
- [ ] Build job verifies successful builds
- [ ] Workflow triggers on PRs to main
- [ ] Branch protection rules documented

## Unit Test Cases
- Verify CI workflow syntax is valid YAML
- Test workflow runs on push to main
- Test workflow runs on PR to main
- Test failed lint blocks merge
- Test failed tests block merge

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-08 | 0.1 | Initial story creation | SM Agent |
