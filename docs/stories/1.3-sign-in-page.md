# Story 1.3: Sign In Page

## Status
Draft

## Parent Epic
[Epic 1: User Authentication & Profile](../epic-1-authentication.md)

## Story
**As a** registered user,
**I want to** log in with my credentials,
**So that** I can access my personalized learning path

## Acceptance Criteria
1. `/sign-in` route renders login form
2. Email/password login
3. Invalid credentials show generic error (security)
4. "Forgot password?" link available
5. Success redirects to `/dashboard` (or `/onboarding` if incomplete)
6. "Remember me" checkbox (extends token expiry)
7. Failed attempts tracked (5 failures = 15 min lockout)
8. Analytics event: `login_completed`

## Tasks / Subtasks
- [ ] Create SignIn page component (AC: 1)
  - [ ] Create `apps/web/src/pages/SignIn.tsx`
  - [ ] Add route `/sign-in` in routes.tsx
- [ ] Build login form (AC: 2)
  - [ ] Add email input field
  - [ ] Add password input field
  - [ ] Add submit button with loading state
- [ ] Add "Remember me" checkbox (AC: 6)
  - [ ] Pass rememberMe flag to login function
  - [ ] Backend extends token expiry when true
- [ ] Handle authentication errors (AC: 3, 7)
  - [ ] Show generic "Invalid email or password" message
  - [ ] Handle account lockout (429 response)
  - [ ] Display lockout duration message
- [ ] Add navigation elements (AC: 4)
  - [ ] Add "Forgot password?" link to /forgot-password
  - [ ] Add "Sign up" link for new users
- [ ] Handle successful login (AC: 5)
  - [ ] Check onboarding status
  - [ ] Redirect to /onboarding if incomplete
  - [ ] Redirect to /dashboard if complete
- [ ] Add analytics tracking (AC: 8)
  - [ ] Track login_completed on success

## Dev Notes

### Error Messages
- Never reveal whether email exists (security)
- Use generic: "Invalid email or password"
- Lockout message: "Too many failed attempts. Try again in X minutes."

### Remember Me
```typescript
const handleSubmit = async (e: React.FormEvent) => {
  await login(email, password, { rememberMe });
};
```

### Redirect Logic
```typescript
const { data: onboardingStatus } = useOnboardingStatus();

// After successful login
if (!onboardingStatus?.completedAt) {
  navigate('/onboarding');
} else {
  navigate('/dashboard');
}
```

### Rate Limiting Response
- 429 Too Many Requests with `retryAfter` header

### Testing
- **Test file location**: `apps/web/src/pages/SignIn.test.tsx`
- **Test standards**: Component tests with user interaction
- **Testing frameworks**: Vitest + @testing-library/react + MSW

## Definition of Done
- [ ] SignIn page renders at /sign-in route
- [ ] Form accepts email and password
- [ ] Invalid credentials show generic error
- [ ] "Forgot password?" link navigates to /forgot-password
- [ ] Successful login redirects appropriately
- [ ] Remember me checkbox present and functional
- [ ] Lockout message displayed after 5 failures
- [ ] Analytics event fires on success

## Unit Test Cases
- Test form renders with email and password fields
- Test form renders "Forgot password?" link
- Test form renders "Remember me" checkbox
- Test invalid credentials show generic error
- Test successful login calls login function
- Test successful login navigates to dashboard
- Test lockout displays retry message
- Test submit button shows loading state

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-08 | 0.1 | Initial story creation | SM Agent |
