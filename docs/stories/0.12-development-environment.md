# Story 0.12: Development Environment (Podman)

## Status
Draft

## Parent Epic
[Epic 0: Technical Foundation](../epic-0-technical-foundation.md)

## Story
**As a** developer,
**I want** a containerized local environment,
**So that** I can run the full stack with `podman-compose up`

## Acceptance Criteria
1. podman-compose.yml for local development
2. PostgreSQL container with volume
3. Redis container
4. MailHog container for email testing
5. Database auto-migration on startup
6. Hot reload working for both apps

## Tasks / Subtasks
- [ ] Create podman-compose.yml (AC: 1)
  - [ ] Create `podman/podman-compose.yml`
  - [ ] Configure version 3.8 format
- [ ] Configure PostgreSQL container (AC: 2)
  - [ ] Add postgres:15-alpine image
  - [ ] Set environment variables (POSTGRES_USER, PASSWORD, DB)
  - [ ] Map port 5432
  - [ ] Create named volume for data persistence
  - [ ] Add health check
- [ ] Configure Redis container (AC: 3)
  - [ ] Add redis:7-alpine image
  - [ ] Map port 6379
  - [ ] Create named volume for data
- [ ] Configure MailHog container (AC: 4)
  - [ ] Add mailhog/mailhog:latest image
  - [ ] Map SMTP port 1025
  - [ ] Map Web UI port 8025
- [ ] Create .env.example (AC: 1)
  - [ ] Document all environment variables
  - [ ] Include DATABASE_URL
  - [ ] Include REDIS_URL
  - [ ] Include JWT secrets
  - [ ] Include SMTP settings for MailHog
  - [ ] Include frontend/backend URLs
- [ ] Document setup steps (AC: 5, 6)
  - [ ] Add setup instructions to README
  - [ ] Document migration command
  - [ ] Document seed command
- [ ] Test full stack startup (AC: 5, 6)
  - [ ] Verify all containers start
  - [ ] Verify hot reload works

## Dev Notes

### Podman Compose Configuration
```yaml
# podman/podman-compose.yml
version: '3.8'

services:
  postgres:
    image: postgres:15-alpine
    container_name: plpg-postgres
    environment:
      POSTGRES_USER: plpg
      POSTGRES_PASSWORD: plpg_local_password
      POSTGRES_DB: plpg_dev
    ports:
      - '5432:5432'
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ['CMD-SHELL', 'pg_isready -U plpg']
      interval: 5s
      timeout: 5s
      retries: 5

  redis:
    image: redis:7-alpine
    container_name: plpg-redis
    ports:
      - '6379:6379'
    volumes:
      - redis_data:/data

  mailhog:
    image: mailhog/mailhog:latest
    container_name: plpg-mailhog
    ports:
      - '1025:1025'
      - '8025:8025'

volumes:
  postgres_data:
  redis_data:
```

### Environment Template
```bash
# .env.example
# Database
DATABASE_URL="postgresql://plpg:plpg_local_password@localhost:5432/plpg_dev"
TEST_DATABASE_URL="postgresql://plpg:plpg_local_password@localhost:5432/plpg_test"

# Redis
REDIS_URL="redis://localhost:6379"

# JWT Authentication
JWT_SECRET="your-super-secret-jwt-key-change-in-production"
JWT_EXPIRES_IN="24h"
BCRYPT_ROUNDS=12

# Email (MailHog for local development)
SMTP_HOST="localhost"
SMTP_PORT=1025
SMTP_FROM="noreply@plpg.local"
MAILHOG_UI="http://localhost:8025"

# App
VITE_API_URL="http://localhost:3001/v1"
FRONTEND_URL="http://localhost:5173"
NODE_ENV="development"
```

### Service URLs
| Service | URL | Purpose |
|---------|-----|---------|
| Frontend | http://localhost:5173 | React application |
| Backend API | http://localhost:3001 | Express API |
| MailHog UI | http://localhost:8025 | View sent emails |
| PostgreSQL | localhost:5432 | Database |
| Redis | localhost:6379 | Cache |

### Testing
- **Test file location**: N/A (infrastructure)
- **Test standards**: Integration test of full stack startup
- **Verification**: Run golden path test script

## Definition of Done
- [ ] podman-compose.yml created with all services
- [ ] PostgreSQL container starts with data persistence
- [ ] Redis container starts and is accessible
- [ ] MailHog captures sent emails
- [ ] .env.example documents all required variables
- [ ] `podman-compose up -d` starts all services
- [ ] `npm run dev` starts both apps with hot reload
- [ ] README documents complete setup process

## Unit Test Cases
- Test PostgreSQL health check passes
- Test Redis responds to ping
- Test MailHog SMTP accepts connections
- Test database migrations run successfully
- Test seed script populates data
- Test frontend connects to backend API
- Test emails are captured in MailHog

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-08 | 0.1 | Initial story creation | SM Agent |
