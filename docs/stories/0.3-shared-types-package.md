# Story 0.3: Shared Types & Utilities Package (@plpg/shared)

## Status
Draft

## Parent Epic
[Epic 0: Technical Foundation](../epic-0-technical-foundation.md)

## Story
**As a** developer,
**I want** shared TypeScript types and Zod schemas,
**So that** frontend and backend use identical contracts

## Acceptance Criteria
1. `@plpg/shared` package with all entity types
2. Zod schemas for runtime validation
3. Utility functions (date formatting, etc.)
4. Constants (enums, magic strings)
5. Package builds and exports correctly

## Tasks / Subtasks
- [ ] Create `packages/shared` package (AC: 1, 5)
  - [ ] Initialize package.json for @plpg/shared
  - [ ] Configure TypeScript for package
- [ ] Define all entity types (AC: 1)
  - [ ] Create `types/user.ts` with User interface
  - [ ] Create `types/onboarding.ts` with OnboardingResponse interface
  - [ ] Create `types/skill.ts` with Skill interface
  - [ ] Create `types/resource.ts` with Resource interface
  - [ ] Create `types/roadmap.ts` with Roadmap, RoadmapModule interfaces
  - [ ] Create `types/progress.ts` with Progress interface
  - [ ] Create `types/subscription.ts` with Subscription interface
  - [ ] Create `types/checkin.ts` with CheckIn interface
  - [ ] Create `types/feedback.ts` with Feedback interface
  - [ ] Create `types/index.ts` barrel file
- [ ] Create Zod validation schemas (AC: 2)
  - [ ] Create `validation/auth.schema.ts` for auth requests
  - [ ] Create `validation/onboarding.schema.ts` for onboarding
  - [ ] Create `validation/progress.schema.ts` for progress tracking
  - [ ] Create `validation/index.ts` barrel file
- [ ] Create shared constants (AC: 4)
  - [ ] Create `constants/phases.ts` with Phase enum
  - [ ] Create `constants/subscription.ts` with plan types
  - [ ] Create `constants/index.ts` barrel file
- [ ] Create utility functions (AC: 3)
  - [ ] Create `utils/date.ts` for date formatting
  - [ ] Create `utils/format.ts` for string formatting
  - [ ] Create `utils/index.ts` barrel file
- [ ] Set up package exports (AC: 5)
  - [ ] Create main `index.ts` barrel file
  - [ ] Configure package.json exports

## Dev Notes

### Package Structure
```
packages/shared/
├── src/
│   ├── types/
│   │   ├── user.ts
│   │   ├── onboarding.ts
│   │   ├── skill.ts
│   │   ├── resource.ts
│   │   ├── roadmap.ts
│   │   ├── progress.ts
│   │   ├── subscription.ts
│   │   ├── checkin.ts
│   │   ├── feedback.ts
│   │   └── index.ts
│   ├── validation/
│   │   ├── auth.schema.ts
│   │   ├── onboarding.schema.ts
│   │   ├── progress.schema.ts
│   │   └── index.ts
│   ├── constants/
│   │   ├── phases.ts
│   │   ├── subscription.ts
│   │   └── index.ts
│   ├── utils/
│   │   ├── date.ts
│   │   ├── format.ts
│   │   └── index.ts
│   └── index.ts
├── tsconfig.json
└── package.json
```

### Auth Validation Schemas
```typescript
import { z } from 'zod';

export const registerSchema = z.object({
  email: z.string().email('Invalid email format'),
  password: z
    .string()
    .min(8, 'Password must be at least 8 characters')
    .regex(/[A-Z]/, 'Password must contain uppercase letter')
    .regex(/[0-9]/, 'Password must contain a number'),
  name: z.string().min(1).optional(),
});

export const loginSchema = z.object({
  email: z.string().email(),
  password: z.string().min(1),
  rememberMe: z.boolean().optional().default(false),
});

export type RegisterInput = z.infer<typeof registerSchema>;
export type LoginInput = z.infer<typeof loginSchema>;
```

### Testing
- **Test file location**: `packages/shared/src/**/*.test.ts`
- **Test standards**: Unit tests for all Zod schemas and utility functions
- **Testing frameworks**: Vitest
- **Coverage target**: >80% for validation schemas

## Definition of Done
- [ ] All entity types defined matching architecture document
- [ ] Zod schemas created for all API request/response types
- [ ] Utility functions implemented and tested
- [ ] Constants defined for enums and magic strings
- [ ] Package builds with `tsc` without errors
- [ ] Exports accessible from other workspaces

## Unit Test Cases
- Test registerSchema validates correct input
- Test registerSchema rejects invalid email formats
- Test registerSchema enforces password requirements (8+ chars, uppercase, number)
- Test loginSchema validates email/password presence
- Test date utility functions format correctly
- Test type exports are accessible from package

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-08 | 0.1 | Initial story creation | SM Agent |
